"""Remove legacy freenas sysctls

Revision ID: 85346ccd33c0
Revises: a3ac49efb063
Create Date: 2020-05-28 16:29:33.277126+00:00

"""
from alembic import op
import subprocess as subp
from middlewared.utils import osc

# revision identifiers, used by Alembic.
revision = '85346ccd33c0'
down_revision = 'a3ac49efb063'
branch_labels = None
depends_on = None


TABLE = 'system_tunable'


def remove_freenas_sysctls():
    conn = op.get_bind()
    conn.execute(
        f'DELETE FROM {TABLE}'
        ' WHERE tun_var'
        ' LIKE "freenas.%"'
    )

def upgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    if osc.IS_FREEBSD:
        remove_freenas_sysctls()

    # ### end Alembic commands ###


def downgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    pass
    # ### end Alembic commands ###
